'use strict';

const Loggers = require('egg-logger').EggLoggers;
// const cluster = require('cluster');

// app可能是agent进程也可能是worker（多个）进程。
module.exports = function createLoggers(app) {
  const loggerConfig = app.config.logger;
  // app.type在agent.js application.js做了赋值。'agent'和'application'。logger初始化有用。
  loggerConfig.type = app.type;
  // console.log('egg logger', process.pid, cluster.isWorker, cluster.isMaster);

  if (app.config.env === 'prod' && loggerConfig.level === 'DEBUG' && !loggerConfig.allowDebugAtProd) {
    loggerConfig.level = 'INFO';
  }
  // Loggers继承自map。
  const loggers = new Loggers(app.config);

  // won't print to console after started, except for local and unittest
  app.ready(() => {
    if (loggerConfig.disableConsoleAfterReady) {
      loggers.disableConsole();
    }
  });
  loggers.coreLogger.info('[egg:logger] init all loggers with options: %j', loggerConfig);

  return loggers;
};
